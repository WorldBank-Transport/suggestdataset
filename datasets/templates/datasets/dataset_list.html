{% extends 'layout.html' %}

{% load i18n %}
{% load el_pagination_tags %}
{% load crispy_forms_tags %}

{% block head_title %}{% trans 'select dataset' %}{% endblock %}

{% block breadcumb %}
    <ol class="breadcrumb">
        <li class="active">
          {% blocktrans with datasets_count=datasets.count %} {{ datasets_count }} datasets found{% endblocktrans %}
        </li>
    </ol>
    <div>
        {% include 'includes/page_share_buttons.html' %}
    </div>
{% endblock %}

{% block page_title %}
    <small class="">
        {% blocktrans %}
            Let us know if there is any dataset you wish to see on Tanzania's Open Data Portal.
            Please check the below list of datasets and 'like' any dataset which interests you.
            If the dataset you are interested in isn't listed yet please use our <a href="#suggest-form">suggest dataset form</a> to request it.
        {% endblocktrans %}
    </small>

    <hr>
{% endblock %}

{% block page_header %}
    <div class="container text-right hidden-lg hidden-sm">
        <button class="btn btn-default btn-xs" id="list-filters-toggle"
                type="button" data-toggle="collapse"
                data-target="#list-filters-container">
            {% trans 'Show filters' %} <i class="fa fa-filter"></i>
        </button>
    </div>
    <div class="row collapse" id="list-filters-container">
        <form class="form-inline">
            <div class="form-group col-sm-3">
                <label class="sr-only">{{ filter.form.name.label }}</label>
                <input type="text" class="form-control input-sm" placeholder="{% trans 'name' %}" value="{{ filter.form.name.value|default:''}}" name="name">
            </div>
            <div class="form-group col-sm-2">
                <label class="sr-only">{% trans "All datasets" %}</label>
                <select class="form-control input-sm filter-select" name="category">
                    <option value='' default>{% trans 'All datasets' %}</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if category.id|stringformat:"i" == filter.form.category.value %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group col-sm-3">
                <label class="sr-only">{% trans "Organization" %}</label>
                <select class="form-control input-sm filter-select" name="organization">
                    <option value='' default>{% trans 'Collection Entity' %}</option>
                    {% for organization in organizations %}
                        <option value="{{ organization.id }}" {% if organization.id|stringformat:"i" == filter.form.organization.value %}selected{% endif %}>{{ organization.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group col-sm-2">
                <label>{% trans "Sort by" %}:</label>
                <select class="form-control input-sm filter-select" name="o">
                    <option value='-likes' default>{% trans 'Most liked' %}</option>
                    <option value="-date_created" {% if filter.form.o.value == '-date_created' %}selected{% endif %}>{% trans 'Latest' %}</option>
                </select>
            </div>
            <div class="form-group col-sm-2">
                <button type="submit" class="btn btn-default btn-sm">{% trans 'Go' %}</button>
                <a href="{% url 'dataset-list' %}" class="btn btn-link btn-sm"><i class="fa fa-refresh"></i></a>
            </div>
        </form>
    </div>
    <hr>
{% endblock %}

{% block content %}
    {% paginate 20 datasets %}
    {% for dataset in datasets %}
        <div class="row">
            <div class="col-sm-2 col-xs-2">
                {% include 'includes/datasets/datasetlike_button.html' %}
            </div>
            <div class="col-sm-10 col-xs-10">
                <p>
                    <a href="{{ dataset.get_absolute_url }}">
                        <strong>{{ dataset.name }}</strong>
                    </a>
                </p>
                {% for category in dataset.categories.all %}
                    <a href="{% url 'dataset-list' %}?category={{ category.id }}">{{ category.name }}</a>
                    {% if not forloop.last %}, {% endif %}
                {% endfor %}
                {% if dataset.description %}
                    <br>{{ dataset.description|truncatechars:100|linebreaks|urlizetrunc:15 }}
                {% endif %}
                {% if dataset.organization %}<div class="">{{ dataset.organization }}</div>{% endif %}
                <p>
                    <label class="text-muted"><strong>{% trans "Status" %}</strong></label>:
                    <span class="text-{{ dataset.is_open_issue|yesno:'success,danger' }}">{{ dataset.is_open_issue|yesno:'Open,Closed' }}</span>,
                    <span class="text-warning">{{ dataset.get_status_display }}</span>
                </p>
                <hr>
            </div>
        </div>
    {% endfor %}

    <div class="text-center">
        {% show_pages %}
    </div>

    <hr id="suggest-form">

    <div class="row">
        <div class="col-sm-2"></div>
        <div class="col-sm-10">
            <div class="well">
                <h4>
                    <small class="text-primary">
                        {% trans 'Add a new suggestion for a dataset to upload to the <a href="http://opendata.go.tz">Open Data Portal</a>' %}
                    </small>
                </h4>
                <form class="form" method="POST" action="{% url 'dataset-suggest' %}">
                    {% csrf_token %}
                    {{ suggest_form|crispy }}
                    <div class="form-group text-right">
                        <input type="reset" value="Cancel" class="btn btn-default">
                        <input type="submit" value="Submit" class="btn btn-primary">
                    </div>
                </form>
            </div>
        </div>
    </div>

    <hr>
{% endblock content %}

{% block extra_js %}
    <script>
        function configureFilterVisibility(){
            if ($(document).width() < 768 ) {
                $('#list-filters-container').addClass('collapse');
            } else {
                $('#list-filters-container').removeClass('collapse in');
            }
            $('#list-filters-container').on('shown.bs.collapse', function () {
                $('#list-filters-toggle').text("{% trans 'Hide filters' %}")
            })
            $('#list-filters-container').on('hidden.bs.collapse', function () {
                $('#list-filters-toggle').text("{% trans 'Show filters' %}")
            })
        };

        $(window).on("resize", configureFilterVisibility);
        $(document).on("ready", configureFilterVisibility);
    </script>
{% endblock %}
