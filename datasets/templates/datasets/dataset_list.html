{% extends 'layout.html' %}

{% load i18n %}
{% load el_pagination_tags %}
{% load crispy_forms_tags %}

{% block head_title %}{% trans 'select dataset' %}{% endblock %}

{% block breadcumb %}
{% endblock %}

{% block page_title %}
    <h3>{% trans "Voting for dataset release" %}</h3>
    <small class="">
        {% url 'dataset-suggest' as suggest_url %}
        {% blocktrans %}
            Let us know if there is any dataset you wish to see on Tanzania's Open Data Portal.
            Please check the below list of datasets and 'like' any dataset which interests you.
            If the dataset you are interested in isn't listed yet please use our <a href="{{ suggest_url }}">request dataset form</a> to request it.
        {% endblocktrans %}
    </small>
{% endblock %}

{% block page_header %}
    <div class="container text-right hidden-lg hidden-sm">
        <button class="btn btn-default btn-xs" id="list-filters-toggle"
                type="button" data-toggle="collapse"
                data-target="#list-filters-container">
            {% trans 'Show filters' %} <i class="fa fa-filter"></i>
        </button>
    </div>
    <div class="row collapse" id="list-filters-container">
        <form class="form-inline">
            <div class="form-group col-sm-3">
                <label class="sr-only">{{ filter.form.name.label }}</label>
                <input type="text" class="form-control input-sm" placeholder="{% trans 'name' %}" value="{{ filter.form.name.value|default:''}}" name="name">
            </div>
            <div class="form-group col-sm-2">
                <label class="sr-only">{% trans "All datasets" %}</label>
                <select class="form-control input-sm filter-select" name="category">
                    <option value='' default>{% trans 'All datasets' %}</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if category.id|stringformat:"i" == filter.form.category.value %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group col-sm-3">
                <label class="sr-only">{% trans "Organization" %}</label>
                <select class="form-control input-sm filter-select" name="organization">
                    <option value='' default>{% trans 'Collection Entity' %}</option>
                    {% for organization in organizations %}
                        <option value="{{ organization.id }}" {% if organization.id|stringformat:"i" == filter.form.organization.value %}selected{% endif %}>{{ organization.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group col-sm-2">
                <label>{% trans "Sort by" %}:</label>
                <select class="form-control input-sm filter-select" name="o">
                    <option value='-likes' default>{% trans 'Most liked' %}</option>
                    <option value="-date_created" {% if filter.form.o.value == '-date_created' %}selected{% endif %}>{% trans 'Latest' %}</option>
                </select>
            </div>
            <div class="form-group col-sm-2">
                <button type="submit" class="btn btn-default btn-sm">{% trans 'Go' %}</button>
                <a href="{% url 'dataset-list' %}" class="btn btn-link btn-sm"><i class="fa fa-refresh"></i></a>
            </div>
        </form>
    </div>
{% endblock %}

{% block content %}
    {% paginate 20 datasets %}
    {% for dataset in datasets %}
        <div class="row">
            <div class="col-sm-2 col-xs-2">
                {% include 'includes/datasets/datasetlike_button.html' %}
            </div>
            <div class="col-sm-10 col-xs-10">
                <p>
                    <a href="{{ dataset.get_absolute_url }}">
                        <strong>{{ dataset.name }}</strong>
                    </a>
                </p>
                {% for category in dataset.categories.all %}
                    <a href="{% url 'dataset-list' %}?category={{ category.id }}" class="text-warning">{{ category.name }}</a>
                    {% if not forloop.last %}, {% endif %}
                {% endfor %}
                {% if dataset.description %}
                    <br>
                    <div class="text-muted">
                        {{ dataset.description|truncatechars:100|linebreaks|urlizetrunc:15 }}
                    </div>
                {% endif %}
                {% if dataset.organization %}<div class="">{{ dataset.organization }}</div>{% endif %}
                <p>
                    <label class="text-muted"><strong>{% trans "Status" %}</strong></label>:
                    <span class="{% if dataset.status == 'approved' %}text-success{% elif dataset.status == 'open' %}text-warning{% elif dataset.status == 'rejected' %}text-danger{% else %}text-muted{% endif %}">
                        {{ dataset.get_status_display }}
                    </span>
                </p>
                <hr>
            </div>
        </div>
    {% endfor %}

    <div class="text-center">
        {% show_pages %}
    </div>

    <hr>
{% endblock content %}

{% block extra_js %}
    <script>
        function configureFilterVisibility(){
            if ($(document).width() < 768 ) {
                $('#list-filters-container').addClass('collapse');
            } else {
                $('#list-filters-container').removeClass('collapse in');
            }
            $('#list-filters-container').on('shown.bs.collapse', function () {
                $('#list-filters-toggle').text("{% trans 'Hide filters' %}")
            })
            $('#list-filters-container').on('hidden.bs.collapse', function () {
                $('#list-filters-toggle').text("{% trans 'Show filters' %}")
            })
        };

        $(window).on("resize", configureFilterVisibility);
        $(document).on("ready", configureFilterVisibility);
    </script>
{% endblock %}
